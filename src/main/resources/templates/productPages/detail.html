<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" xmlns:th="http://www.thymeleaf.org">
    <title>상품 상세 조회</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/js/jquery-3.6.0.min.js}"></script>
    <style>
        .btn {
            float: right;
            margin-top: 20px;
        }
    </style>
</head>
<body>
<th:block th:replace="commonPages/header :: header"></th:block>
    <div class="container">
        <div th:if="${session.loginId}">
            <button th:if="${session.loginMemberId.toString().equals('admin')}" class="btn btn-outline-primary" onclick="req(1)">상품정보수정</button>
            <button th:if="${session.loginMemberId.toString().equals('admin')}" class="btn btn-outline-danger" onclick="req(2)">상품 삭제</button>
        </div>
        <table class="table">
            <tr>
                <td style="font-size: 35px;" th:text="${product.productName}">상품명</td>
            </tr>
            <tr>
                <td style="float: right; font-size: 11px; color: gray;" th:text="${product.id}"></td>
                <td style="float: right; font-size: 11px; color: gray;">상품번호</td>
                <td style="float: right; font-size: 11px; color: gray;" th:text="${product.productHits}"></td>
                <td style="float: right; font-size: 11px; color: gray;">조회수</td>
            </tr>
        </table>
        <table class="table">
            <tr>
                <td colspan="4"><img th:src="@{|/upload/${product.productFileName}|}" width="400" height="300" alt=""></td>
                <td th:text="${product.productPrice}">판매가</td>
                <td th:text="${product.productBrand}">상품 브랜드</td>
                <td><input type="button" class="btn btn-outline-info" th:onclick="productOrder([[${product.id}]])" value="주문하기"></td>
            </tr>
            <tr>
                <td rowspan="4" th:text="${product.productInformation}"></td>
            </tr>
        </table>
    </div>
</body>
<script th:inline="javascript">
    const req = (num) => {
        const id = [[${product.id}]];
        if(num == 1){
            location.href = "/product/update/" + id;
        }
        else if(num == 2){
            const deleteCheck = confirm("상품을 삭제하겠습니까?");
            if(deleteCheck){
                $.ajax({
                    type: "delete",
                    url: "/product/"+ id,
                    success:function (){
                        location.href = "/product";
                    },
                    error:function (){
                        alert("상품 삭제 실패")
                    }
                })
            }
        }
    }

    const productOrder = (id) => {
        const member = [[${session.loginMemberId}]]
        if(member == null){
            alert("비회원은 주문할 수 없습니다.");
            const login = confirm("로그인을 하시겠습니까?");
            if(login){
                location.href='/member/login-form';
            }
        }
        else{
            if(member == "admin"){
                alert("관리자는 주문할 수 없습니다.");
            }
            else{
                location.href="/order/save-form/" + id;
            }
        }
    }
</script>
</html>